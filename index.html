<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Garbage Compactor Status</title>
    <link rel="stylesheet" href="style.css">
    <!-- Include Firebase SDK (Modular version) -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-analytics.js";
        import { getFirestore, doc, onSnapshot, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-firestore.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
          apiKey: "your-api-key",
          authDomain: "your-auth-domain",
          databaseURL: "your-database-url",
          projectId: "your-project-id",
          storageBucket: "your-storage-bucket",
          messagingSenderId: "your-messaging-sender-id",
          appId: "your-app-id",
          measurementId: "your-measurement-id"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);

        // Get a reference to Firestore
        const db = getFirestore(app);

        // Reference to the status document
        const statusDocRef = doc(db, 'status', 'compactor');

        // Get the current status and timestamp
        onSnapshot(statusDocRef, (doc) => {
            if (doc.exists()) {
                const data = doc.data();
                document.getElementById('status').innerText = data.status;

                if (data.timestamp) {
                    const date = data.timestamp.toDate();
                    document.getElementById('timestamp').innerText = `Last updated: ${date.toLocaleString()}`;
                } else {
                    document.getElementById('timestamp').innerText = 'No timestamp available';
                }
            } else {
                document.getElementById('status').innerText = 'No status reported';
                document.getElementById('timestamp').innerText = '';
            }
        });

        // Update status and set timestamp
        window.updateStatus = function(newStatus) {
            setDoc(statusDocRef, { 
                status: newStatus,
                timestamp: serverTimestamp()
            }, { merge: true })
            .then(() => {
                console.log('Status updated successfully');
                showThankYouMessage();
            })
            .catch((error) => {
                console.error('Error updating status: ', error);
            });
        }

        // Function to show thank you message
        function showThankYouMessage() {
            const thankYouMessage = document.getElementById('thank-you-message');
            thankYouMessage.style.display = 'block';
        }
    </script>
</head>
<body>
    <header>
        <h1>Garbage Compactor Status</h1>
    </header>
    <main>
        <div id="status" class="status">Loading...</div>
        <div id="timestamp" class="timestamp"></div>
        <div class="buttons">
            <button onclick="updateStatus('Empty')">Empty</button>
            <button onclick="updateStatus('Half-Filled')">Half Filled</button>
            <button onclick="updateStatus('Full')">Full</button>
        </div>
        <div id="thank-you-message">
            Thanks for checking on, and updating the state of the garbage compactor responsibly for a better dorm :)
        </div>
    </main>
</body>
</html>
